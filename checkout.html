  <!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Finalizar Compra - Loja Pulse</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdn.rawgit.com/metafloor/bwip-js/master/bwip-js.min.js"></script>

    <style>
        #qrCodeContainer {
            display: none;
            margin-top: 20px;
            text-align: center; /* Centraliza o conteúdo do container */
        }
    
        #qrCode {
            display: inline-block; /* Garante que o QR Code se alinhe no centro */
        }
        #creditCardFields, #debitCardFields, #installmentOptions {
            display: none;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <!-- Cabeçalho -->
    <header>
        <h1>Loja Pulse</h1>
        <p>Finalize sua compra!</p>
    </header>

    <!-- Conteúdo principal -->
    <div class="contact-form">
        <h2>Itens no Carrinho</h2>
        <div id="cartItems">
            <!-- Os itens do carrinho serão exibidos aqui -->
        </div>

        <h3>Informações de Entrega</h3>
        <form id="deliveryForm">
            <label for="name">Nome Completo:</label>
            <input type="text" id="name" name="name" required>

            <label for="address">Endereço:</label>
            <input type="text" id="address" name="address" required>

            <label for="city">Cidade:</label>
            <input type="text" id="city" name="city" required>

            <label for="postalCode">CEP:</label>
            <input type="text" id="postalCode" name="postalCode" required>

            <h3>Método de Pagamento</h3>
            <label for="paymentMethod">Selecione o método de pagamento:</label>
            <select id="paymentMethod" name="paymentMethod" required>
                <option value="">Selecione...</option>
                <option value="credit">Cartão de Crédito</option>
                <option value="debit">Cartão de Débito</option>
                <option value="pix">Pix</option>
                <option value="boleto">Boleto Bancário</option>
            </select>

            <div id="installmentOptions">
                <label for="installments">Selecione o número de parcelas (máximo 5):</label>
                <select id="installments" name="installments">
                    <option value="1">1x sem juros</option>
                    <option value="2">2x sem juros</option>
                    <option value="3">3x sem juros</option>
                    <option value="4">4x sem juros</option>
                    <option value="5">5x sem juros</option>
                </select>
            </div>

            <!-- Campos para os dados do cartão de crédito e débito -->
            <div id="creditCardFields">
                <h4>Preencha os dados do Cartão de Crédito:</h4>
                <label for="cardNumber">Número do Cartão:</label>
                <input type="text" id="cardNumber" name="cardNumber">

                <label for="cardHolder">Nome no Cartão:</label>
                <input type="text" id="cardHolder" name="cardHolder">

                <label for="expiryDate">Data de Validade (MM/AA):</label>
                <input type="text" id="expiryDate" name="expiryDate">

                <label for="cvv">CVV:</label>
                <input type="text" id="cvv" name="cvv">
            </div>

            <div id="debitCardFields">
                <h4>Preencha os dados do Cartão de Débito:</h4>
                <label for="debitCardNumber">Número do Cartão:</label>
                <input type="text" id="debitCardNumber" name="debitCardNumber">

                <label for="debitCardHolder">Nome no Cartão:</label>
                <input type="text" id="debitCardHolder" name="debitCardHolder">

                <label for="debitExpiryDate">Data de Validade (MM/AA):</label>
                <input type="text" id="debitExpiryDate" name="debitExpiryDate">

                <label for="debitCvv">CVV:</label>
                <input type="text" id="debitCvv" name="debitCvv">
            </div>

            <input type="submit" value="Confirmar Pedido">
        </form>

        <!-- Container para o QR Code -->
        <div id="qrCodeContainer" class="qr-code">
            <h4>Escaneie o QR Code para pagamento via Pix:</h4>
            <div id="qrCode"></div>
        </div>
    </div>

    <!-- Rodapé -->
    <footer>
        <p>Loja Brasileira - Todos os direitos reservados &copy; 2024</p>
    </footer>

    <script>
        // Exibe o resumo dos itens no carrinho
        const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
        const cartSummary = document.getElementById('cartItems');
        if (cartItems.length === 0) {
            cartSummary.innerHTML = '<p>O carrinho está vazio.</p>';
        } else {
            cartItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('cart-item');
                itemElement.innerHTML = `<span>${item.name} - R$ ${item.price}</span>`;
                cartSummary.appendChild(itemElement);
            });
        }

        // Exibe campos conforme método de pagamento selecionado
        const paymentMethod = document.getElementById('paymentMethod');
        const creditCardFields = document.getElementById('creditCardFields');
        const debitCardFields = document.getElementById('debitCardFields');
        const installmentOptions = document.getElementById('installmentOptions');

        paymentMethod.addEventListener('change', function() {
            creditCardFields.style.display = 'none';
            debitCardFields.style.display = 'none';
            installmentOptions.style.display = 'none';
            document.getElementById('qrCodeContainer').style.display = 'none';

            if (this.value === 'credit') {
                creditCardFields.style.display = 'block';
                installmentOptions.style.display = 'block';
            } else if (this.value === 'debit') {
                debitCardFields.style.display = 'block';
            }
        });

        // Evento de submit para o formulário
        const deliveryForm = document.getElementById('deliveryForm');
        deliveryForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Evita o envio padrão

            const paymentMethodValue = paymentMethod.value;

            if (paymentMethodValue === 'pix') {
                const qrCodeContainer = document.getElementById('qrCodeContainer');
                const qrCodeElement = document.getElementById('qrCode');
                qrCodeElement.innerHTML = '';
                
                // Gera o código PIX
                const pixCode = '00020101021126780014BR.GOV.BCB.PIX0136+55219876543250004000053039865406Test Loja Pulse6304ABC1';
                
                // Gera o QR Code usando a biblioteca QRCode
                new QRCode(qrCodeElement, {
                    text: pixCode,
                    width: 256,
                    height: 256
                });

                qrCodeContainer.style.display = 'block';
                alert('Pedido confirmado! Escaneie o QR Code para pagamento via Pix.');
            }else if (paymentMethodValue === 'boleto') {
                // Apenas gera o PDF com os dados do endereço e itens do carrinho
                const name = document.getElementById('name').value; // Obtém o nome do formulário
                const address = document.getElementById('address').value; // Obtém o endereço
                const city = document.getElementById('city').value; // Obtém a cidade
                const postalCode = document.getElementById('postalCode').value; // Obtém o CEP
            
                alert('O boleto está sendo gerado...');
            
                // Gera o PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF();
            
                // Desenha a tabela para os dados de entrega
                const startY = 10;
                const cellHeight = 10;
                const tableWidth = 180;
            
                // Cabeçalho da tabela
                pdf.rect(10, startY, tableWidth, cellHeight); // Tabela principal
                pdf.text("Dados de Entrega", 12, startY + 7); // Título da tabela
            
                // Linhas de dados
                const deliveryData = [
                    { label: 'Nome', value: name },
                    { label: 'Endereço', value: address },
                    { label: 'Cidade', value: city },
                    { label: 'CEP', value: postalCode }
                ];
            
                deliveryData.forEach((data, index) => {
                    const y = startY + cellHeight + (index * cellHeight);
                    pdf.rect(10, y, tableWidth, cellHeight); // Linha da tabela
                    pdf.text(data.label, 12, y + 7); // Label
                    pdf.text(data.value, 100, y + 7); // Valor
                });
            
                // Adiciona os itens do carrinho ao PDF
                const itemsStartY = startY + (deliveryData.length + 1) * cellHeight;
                pdf.text(`\nItens no Carrinho:`, 10, itemsStartY);
            
                // Adiciona uma linha em branco para criar espaço
                pdf.text('', 10, itemsStartY + 10);  // Linha em branco
            
                // Desenha a tabela para os itens do carrinho
                const itemsTableStartY = itemsStartY + 20;
                pdf.rect(10, itemsTableStartY, tableWidth, cellHeight); // Tabela principal para itens
                pdf.text("Itens", 12, itemsTableStartY + 7); // Título da tabela
            
                cartItems.forEach((item, index) => {
                    const itemY = itemsTableStartY + cellHeight + (index * cellHeight);
                    pdf.rect(10, itemY, tableWidth, cellHeight); // Linha da tabela
                    pdf.text(`${index + 1}. ${item.name}`, 12, itemY + 7); // Nome do item
                    pdf.text(`R$ ${item.price}`, 100, itemY + 7); // Preço do item
                });
                
            
                // Número do código de barras
                const barcodeNumber = '12345678901234567890'; // Substitua por seu número de código de barras
                const barcodeY = itemsTableStartY + (cartItems.length + 1) * cellHeight + 20;  // Posição Y abaixo dos itens
            
                // Adiciona o número do código de barras ao PDF
                pdf.text(`Código de Barras: ${barcodeNumber}`, 10, barcodeY);
            
                // Linha de caracteres abaixo do código de barras
                const lineText = 'IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII';
                const lineY = barcodeY + 10;  // Posição Y para a linha de caracteres
                pdf.text(lineText, 10, lineY); // Adiciona a linha de caracteres ao PDF
            
                // Salva o PDF como um arquivo
                pdf.save(`informacoes_entrega_${name}.pdf`);
            
                alert('Pedido confirmado! O PDF com os dados de entrega, os itens da compra e o código de barras foi gerado e baixado.');
            }
        });
    </script>
</body>
</html>
